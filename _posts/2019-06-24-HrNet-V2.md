---
layout: post
title: HrNet V2总结
---

**摘要**：为了提高语义分割的精度，目前主流的趋势是先降低分辨率提取高级的语义特征，再采取多样的方法从低分辨率表示恢复到高分辨表示。在本文中则不然，HrNet V2在整个过程中都保持着高分辨率的表示。该模型分为先后五个阶段，第一阶段下采样到输入图像原有尺寸的1/4。随后，每一个阶段的开始添加从高分辨率通过下采样得到的低分辨率子网，结束前进行重复的多尺度融合，使得每一个分辨率可以重复的从其他分辨率获取信息。最后在第五阶段将所有的并行低分辨率子网的输出上采样到高分辨率子网的尺寸大小，然后通过连接所有的子网的表示获取到具有丰富信息的高分辨率表示。该模型在许多典型的语义分割数据集上都取得了更为精确的分割结果。

----

### 1、现有方法
&emsp;&emsp;计算最后的heatmap表示有两条主线。第一种是从网络（例如，ResNet）输出的低分辨率表示中恢复高分辨率表示，并且可选地恢复中间中等分辨率表示，例如Hourglass ，SegNet，DeconvNet，U-Net，和encoder-decoder。 另一个是通过高分辨率卷积保持高分辨率表示，并用并行的低分辨率卷积加强高分辨率表示。 此外，空洞卷积用于替换分类网络中的一些跨步卷积和相关的常规卷积，以计算中等分辨率表示。<br>
&emsp;&emsp;主线一的的典型方法包括以下4种：<br>
![从低分辨率表示恢复高分辨率表示](../assets/images/HrNet/HrNet1.JPG)<br>
&emsp;&emsp;* a:对称结构。如U-Net等。先下采样，再上采样，使用跳层连接恢复下采样的信息。<br>
&emsp;&emsp;* b:级联金字塔。<br>
&emsp;&emsp;* c:先下采样，再使用转置卷积进行上采样。没有跳层连接<br>
&emsp;&emsp;* d:扩张卷积。增大感受野，在可以减少下采样的次数的同时直接可以不进行跳层连接而直接进行上采样<br>
&emsp;&emsp;本文正是沿着第二条主线进行的研究。下面的将对HrNet V2做出详细的介绍。

### 2、HrNet V2方法概述
#### 2.1、HrNet V2框架
&emsp;&emsp;HrNet通过连接并行的不同分辨率表示和重复进行多尺度融合来维持高分辨率表示，由此产生的高分辨率表示不仅信息丰富而且空间精确。HrNet V2对HrNet进行了简单的修改。此修改增加了较小的开销，但是有着更强的高分辨率表示。如下图所示是HrNet V2的整体框架：
![HrNet V2框架](../assets/images/HrNet/HrNet2.JPG)<br>
&emsp;&emsp;整个模块分为5个阶段：stem、stage1、stage2、stage3、stage4.在作者提供的开源代码中，将产生低分辨分支的功能以及重复的多尺度融合功能进行了分离，产生低分辨分支的功能在stage1、stage2、stage3阶段开头，重复的多尺度融合功能在stage1、stage2、stage3阶段的结尾。所以，在上图中，我将每一阶段的区分线画在了图中交叉线的中间。竖线1的左方是原始的HrNet表示。它直接输出stage3中的最上方的高分辨率表示，使其作为最后的heatmap。而HrNet V2则在其基础上添加了竖线1右边的部分。它首先将三个并行低分辨率子网的输出上采样到高分辨率子网的尺寸大小，然后通过简单的连接操作连接同样尺寸大小的四个分支的结果。最后将连接的结果通过1×1的卷积将通道数转变为语义分割的类别数目从而得到最后的结果。下面详细的介绍每一个阶段的具体处理步骤:<br>
&emsp;&emsp;1）**stem**。stem中完成的三个箭头代表着3个不同的处理。前两个处理使用步长为2的3×3卷积操作将输入图像卷积两次。从而使得图像的高（H）和宽（W）变为H/4与W/4的大小。随后的第三个处理使用4个Basicblock或者bottleblock进行处理，起到提取特征的作用。随后得到的输出（大小为[H/4，W/4，256]）被输入stage1中。<br>
&emsp;&emsp;2）**stage1**。首先在上一阶段的基础上产生一个低分辨率的分支。然后每一个分支分别利用4个Basicblock或者bottleblock进行特征提取。最后进行多尺度融合得到最后的输出。随后将得到的输出（大小分别为[H/4，W/4，32]，[H/8，W/8，64]）输入stage2中<br>
&emsp;&emsp;3）**stage2**。<br>首先在上一阶段的基础上产生一个低分辨率的分支。然后每一个分支分别利用4个Basicblock或者bottleblock进行特征提取。最后进行多尺度融合得到最后的输出。随后将得到的输出（大小分别为[H/4，W/4，32]，[H/8，W/8，64]，[H/16，W/16，128]）输入stage3中<br>
&emsp;&emsp;4）**stage3**。首先在上一阶段的基础上产生一个低分辨率的分支。然后每一个分支分别利用4个Basicblock或者bottleblock进行特征提取。最后进行多尺度融合得到最后的输出。随后将得到的输出（大小分别为[H/4，W/4，32]，[H/8，W/8，64]，[H/16，W/16，128]，[H/32，W/32，256]）输入stage3中<br><br>
&emsp;&emsp;5）**stage4**。这个阶段的功能在本节开始时已经介绍，这里不加赘述<br>

#### 2.2、重复的多尺度融合


### 3、代码详解
#### 3.1、代码整体感知

#### 3.2、Basic block与ResNet block

#### 3.3、HighResolutionModule

### 4、总结
